<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>

<body>
<video id="video" autoplay style="display:none;"></video>

<script>
  const video = document.getElementById("video");

  async function initCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    await video.play();
  }

  const pose = new Pose.Pose({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
  });

  pose.setOptions({
    modelComplexity: 1,
    smoothLandmarks: true,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
  });

  pose.onResults((results) => {
    const landmarks = results.poseLandmarks || [];
    const message = JSON.stringify(landmarks);
    window.parent.postMessage({ type: "FROM_JS", value: message }, "*");
  });

  async function run() {
    await initCamera();

    const camera = new CameraUtils.Camera(video, {
      onFrame: async () => {
        await pose.send({ image: video });
      }
    });

    camera.start();
  }

  run();
</script>
</body>
</html>
